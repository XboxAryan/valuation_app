<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Investment Valuation Platform</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_professional.css') }}?v=3">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ðŸ“Š Investment Analytics Platform</h1>
            <div class="nav-links">
                <a href="#" onclick="showView('dashboard')" class="nav-link active" data-view="dashboard">Dashboard</a>
                <a href="#" onclick="showView('companies')" class="nav-link" data-view="companies">Portfolio</a>
                <a href="#" onclick="exportCSV()" class="nav-link">Export Data</a>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">ðŸŒ“</button>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view-section active">
            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card" onclick="showView('companies')">
                    <div class="stat-header">
                        <div class="stat-label">Total Companies</div>
                        <div class="stat-trend positive" id="total-trend">
                            <span>â†‘</span>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="total-companies">0</div>
                    <div class="stat-subtitle">Tracked securities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Avg Upside Potential</div>
                        <div class="stat-trend positive" id="upside-trend">
                            <span>â†‘</span>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="avg-upside">0%</div>
                    <div class="stat-subtitle">vs. current market price</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Portfolio P/E</div>
                        <div class="stat-trend" id="pe-trend">
                            <span>â€”</span>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="avg-pe">0.0x</div>
                    <div class="stat-subtitle">Price-to-earnings multiple</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Avg ROE</div>
                        <div class="stat-trend positive" id="roe-trend">
                            <span>â†‘</span>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="avg-roe">0%</div>
                    <div class="stat-subtitle">Return on equity</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Avg WACC</div>
                        <div class="stat-trend" id="wacc-trend">
                            <span>â€”</span>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="avg-wacc">0%</div>
                    <div class="stat-subtitle">Weighted avg cost of capital</div>
                </div>
            </div>

            <!-- Investment Recommendations -->
            <div class="recommendation-grid">
                <div class="rec-card buy">
                    <div class="rec-title">Strong Buy / Buy</div>
                    <div class="rec-count" id="buy-count">0</div>
                    <div class="rec-percentage" id="buy-pct">0% of portfolio</div>
                </div>
                <div class="rec-card hold">
                    <div class="rec-title">Hold</div>
                    <div class="rec-count" id="hold-count">0</div>
                    <div class="rec-percentage" id="hold-pct">0% of portfolio</div>
                </div>
                <div class="rec-card sell">
                    <div class="rec-title">Sell / Underweight</div>
                    <div class="rec-count" id="sell-count">0</div>
                    <div class="rec-percentage" id="sell-pct">0% of portfolio</div>
                </div>
            </div>

            <!-- Sector Analysis Table -->
            <div class="sector-analysis">
                <div class="section-title">
                    <span>Sector Analysis & Performance</span>
                    <div class="section-actions">
                        <button class="filter-btn" onclick="sortSectorBy('upside')">Sort by Upside</button>
                        <button class="filter-btn" onclick="sortSectorBy('count')">Sort by Count</button>
                    </div>
                </div>
                <table class="sector-table">
                    <thead>
                        <tr>
                            <th>Sector</th>
                            <th>Companies</th>
                            <th>Avg Upside</th>
                            <th>Avg ROE</th>
                            <th>Avg P/E</th>
                            <th style="text-align: right;">Performance</th>
                        </tr>
                    </thead>
                    <tbody id="sector-breakdown">
                        <!-- Sector rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Companies/Portfolio View -->
        <div id="companies-view" class="view-section">
            <!-- Toolbar with Search and Filters -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <input type="text" class="search-input" id="company-search" placeholder="Search companies..." onkeyup="filterCompanies()">
                    <button class="filter-btn" id="filter-all" onclick="filterByRecommendation('all')">All</button>
                    <button class="filter-btn" id="filter-buy" onclick="filterByRecommendation('buy')">Buy</button>
                    <button class="filter-btn" id="filter-hold" onclick="filterByRecommendation('hold')">Hold</button>
                    <button class="filter-btn" id="filter-sell" onclick="filterByRecommendation('sell')">Sell</button>
                </div>
                <div class="toolbar-group">
                    <select class="sort-select" id="company-sort" onchange="sortCompanies()">
                        <option value="name">Sort: Name (A-Z)</option>
                        <option value="upside-desc">Sort: Upside (High-Low)</option>
                        <option value="upside-asc">Sort: Upside (Low-High)</option>
                        <option value="roe-desc">Sort: ROE (High-Low)</option>
                        <option value="pe-asc">Sort: P/E (Low-High)</option>
                        <option value="sector">Sort: Sector</option>
                    </select>
                    <button class="btn-primary" onclick="showAddCompanyModal()">+ Add Company</button>
                </div>
            </div>

            <div class="companies-header">
                <h2 class="page-title">Portfolio Companies (<span id="companies-count">0</span>)</h2>
            </div>

            <div class="companies-grid" id="companies-grid">
                <!-- Companies will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Company Modal -->
    <div id="company-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="modal-title">Add Company</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="company-form">
                    <input type="hidden" id="company-id">
                    
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Company Name *</label>
                                <input type="text" id="name" required>
                            </div>
                            <div class="form-group">
                                <label>Sector *</label>
                                <input type="text" id="sector" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Financial Data</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Revenue ($)</label>
                                <input type="number" id="revenue" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>EBITDA ($)</label>
                                <input type="number" id="ebitda" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Depreciation ($)</label>
                                <input type="number" id="depreciation" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Profit Margin (%)</label>
                                <input type="number" id="profit_margin" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>CapEx (% of Revenue)</label>
                                <input type="number" id="capex_pct" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Working Capital Change ($)</label>
                                <input type="number" id="working_capital_change" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Growth Rates (%)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Year 1-2 Growth</label>
                                <input type="number" id="growth_rate_y1" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Year 3-4 Growth</label>
                                <input type="number" id="growth_rate_y2" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Year 5-6 Growth</label>
                                <input type="number" id="growth_rate_y3" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Terminal Growth</label>
                                <input type="number" id="terminal_growth" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Capital Structure</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Shares Outstanding</label>
                                <input type="number" id="shares_outstanding" step="1">
                            </div>
                            <div class="form-group">
                                <label>Debt ($)</label>
                                <input type="number" id="debt" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Cash ($)</label>
                                <input type="number" id="cash" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Market Cap Estimate ($)</label>
                                <input type="number" id="market_cap_estimate" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Tax Rate (%)</label>
                                <input type="number" id="tax_rate" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Risk Parameters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Beta</label>
                                <input type="number" id="beta" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Risk-Free Rate (%)</label>
                                <input type="number" id="risk_free_rate" step="0.01" value="4.5">
                            </div>
                            <div class="form-group">
                                <label>Market Risk Premium (%)</label>
                                <input type="number" id="market_risk_premium" step="0.01" value="6.5">
                            </div>
                            <div class="form-group">
                                <label>Country Risk Premium (%)</label>
                                <input type="number" id="country_risk_premium" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label>Size Premium (%)</label>
                                <input type="number" id="size_premium" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Comparable Multiples</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Industry EV/EBITDA</label>
                                <input type="number" id="comparable_ev_ebitda" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Industry P/E</label>
                                <input type="number" id="comparable_pe" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Industry PEG</label>
                                <input type="number" id="comparable_peg" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn-submit">Save Company</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Valuation Results Modal -->
    <div id="valuation-modal" class="modal">
        <div class="modal-content xlarge">
            <div class="modal-header">
                <h2 id="valuation-company-name">Detailed Valuation Analysis</h2>
                <span class="close" onclick="closeValuationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="valuation-results"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="modal" style="display: none;">
        <div class="loading-container">
            <div class="spinner"></div>
            <div class="loading-text" id="loading-text">Processing valuation...</div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}?v=3"></script>
</body>
</html>
